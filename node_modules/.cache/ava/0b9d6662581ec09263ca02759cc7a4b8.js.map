{"version":3,"sources":["test/feed.test.js"],"names":["test","before","t","context","api","respFeeds","get","is","status","feeds","data","feedKey","i","key","respDelete","delete","feed","name","description","resp","post","beforeEach","only","console","log"],"mappings":"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","sourceRoot":"/home/kate/moeco/adafruit","sourcesContent":["import test from 'ava';\nimport {\n    getApi,\n    auth,\n    logout,\n    responseErrMessage as err\n} from '../shortcuts';\n\ntest.before('Create feed', async t => {\n    // Authorise\n    t.context.api = await getApi();\n    await auth(t.context.api);\n\n    // Delete all existing feeds\n    const respFeeds = await t.context.api.get('/feeds');\n    t.is(respFeeds.status, 200, err(respFeeds));\n    const feeds = respFeeds.data;\n    let feedKey;\n    for (let i in feeds) {\n        feedKey = feeds[i].key;\n        const respDelete = await t.context.api.delete(`/feeds/${feedKey}`);\n        t.is(respDelete.status, 200, err(respDelete));\n    }\n\n    // Create feed\n    const feed = { name: 'autotest-feed-default', description: 'default feed generated by api autotest'};\n    const resp  = await t.context.api.post('/feeds', feed);\n    t.is(resp.status, 201, err(resp));\n    t.context.feed = resp.data;\n});\n\ntest.beforeEach('Login', async t => {\n    await auth(t.context.api);\n});\n\ntest('Create feed works', async t => {\n    const feed = { name: 'autotest-feed1', description: 'feed generated by api autotest1'};\n    const resp  = await t.context.api.post('/feeds', feed);\n    t.is(resp.status, 201, err(resp));\n});\n\ntest.only('Create feed fails without token', async t => {\n    await logout(t.context.api);\n    const feed = { name: 'autotest-feed', description: 'feed generated by api autotest'};\n    const resp  = await t.context.api.post('/feeds', feed);\n    t.is(resp.status, 401, err(resp));\n});\n\ntest.only('Create feed fails with wrong inputs', async t => {\n    const feed = { name: null, description: null};\n    const resp  = await t.context.api.post('/feeds', feed);\n    t.is(resp.status, 400, err(resp));\n});\n\ntest('Get all feeds works', async t => {\n    const resp = await t.context.api.get('/feeds');\n    t.is(resp.status, 200, err(resp));\n    console.log(resp.data);\n    // t.is(resp.data[0].owner.username, 'korneed');\n});\n\n// test('Delete feed works', async t => {\n//     const respDelete = await t.context.api.delete(`/feeds/${t.context.feed.key}`);\n//     t.is(respDelete.status, 200, err(respDelete));\n// });\n\n// Get all feeds does not work without auth\n// Get feed by id works\n// Get feed by id does not work without auth\n\n// // Also add tv4 validation\n\n// test.skip('Feeds are displayed in groups', async t => {\n//     const api = await getApi();\n//     await auth(api);\n//     const resp = await api.get('/groups');\n//     t.is(resp.status, 200);\n//     t.is(resp.data[0].feeds[0].name, 'new_feed');\n// });"]}