{"version":3,"sources":["test/feed.js"],"names":["test","before","t","context","api","feed","beforeEach","name","description","resp","post","is","status","validateBySchema","data","feedSchema","serial","createFeedMacro","feedObject","expected","title","providedTitle","JSON","stringify","trim","undefined","resp1","resp2","get","owner","username","user","deepEqual","respDelete","delete","key"],"mappings":"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","sourceRoot":"/home/kate/moeco/adafruit","sourcesContent":["import test from 'ava';\nimport {\n    getApi,\n    auth,\n    logout,\n    responseErrMessage as err,\n    createFeed\n} from './helpers/shortcuts';\nimport { ADAFRUIT_IO_USERNAME as user } from './helpers/fixtures';\nimport feedSchema from './helpers/schemas/feed.json';\n\ntest.before('Create feed', async t => {\n    // Authorise\n    t.context.api = await getApi();\n    auth(t.context.api);\n\n    t.context.feed = await createFeed(t, t.context.api);\n});\n\ntest.beforeEach('Authorise', async t => {\n    t.context.api = await getApi();\n    auth(t.context.api);\n});\n\ntest('Create feed works', async t => {\n    const feed = { name: 'autotest-feed', description: 'feed generated by api autotest'};\n    const resp  = await t.context.api.post('/feeds', feed);\n    t.is(resp.status, 201, err(resp));\n    validateBySchema(t, resp.data, feedSchema);\n});\n\n// Serial because logout influences parallel tests otherwise\ntest.serial('Create feed fails without token', async t => {\n    logout(t.context.api);\n\n    const feed = { name: 'autotest-feed', description: 'feed generated by api autotest'};\n    const resp  = await t.context.api.post('/feeds', feed);\n    t.is(resp.status, 401, err(resp));\n});\n\nasync function createFeedMacro(t, feedObject, expected) {\n    const resp  = await t.context.api.post('/feeds', feedObject);\n    t.is(resp.status, expected, err(resp));\n};\ncreateFeedMacro.title = (providedTitle = '', feedObject, expected) => `Create feed with ${ JSON.stringify(feedObject) } returns status ${ JSON.stringify(expected, null, 2) }. ${providedTitle}`.trim();\n\n\ntest(createFeedMacro, {name: null, description: null}, 400);\ntest(createFeedMacro, {name: null, description: 'test0'}, 400);\ntest(createFeedMacro, {name: 'test0', description: null}, 201);\ntest(createFeedMacro, {name: undefined, description: undefined}, 400);\ntest(createFeedMacro, {name: 'test1'}, 201);\ntest('Without name feed is not created', createFeedMacro, {description: 'test1'}, 400);\n\ntest('Create feed with not unique name fails', async t => {\n    const feed = { name: 'autotest-feed-not-unique'};\n    const resp1  = await t.context.api.post('/feeds', feed);\n    t.is(resp1.status, 201, err(resp1));\n\n    const resp2  = await t.context.api.post('/feeds', feed);\n    t.is(resp2.status, 400, err(resp2));\n});\n\ntest('Get all feeds works', async t => {\n    const resp = await t.context.api.get('/feeds');\n    t.is(resp.status, 200, err(resp));\n    t.is(resp.data[0].owner.username, user);\n});\n\n// Serial because logout influences parallel tests otherwise\ntest.serial('Get all feeds returns empty result without token', async t => {\n    logout(t.context.api);\n\n    const resp = await t.context.api.get('/feeds');\n    t.is(resp.status, 200, err(resp));\n    t.deepEqual(resp.data, []);\n});\n\ntest('Delete feed works', async t => {\n    // Create feed\n    const feedObject = { name: 'autotest-feed-to-delete', description: 'feed generated by api autotest to delete'};\n    const feed = await createFeed(t, t.context.api, feedObject);\n\n    const respDelete = await t.context.api.delete(`/feeds/${feed.key}`);\n    t.is(respDelete.status, 200, err(respDelete));\n});\n\ntest('Get feed by id works', async t => {\n    const resp = await t.context.api.get(`/feeds/${t.context.feed.key}`);\n    t.is(resp.status, 200, err(resp));\n    t.is(resp.data.owner.username, user);\n});\n\n// Serial because logout influences parallel tests otherwise\ntest.serial('Get feed by id fails without token', async t => {\n    logout(t.context.api);\n\n    const resp = await t.context.api.get(`/feeds/${t.context.feed.key}`);\n    t.is(resp.status, 404, err(resp));\n});"]}